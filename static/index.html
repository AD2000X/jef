<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JEF Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slider-container {
            width: 100%;
            padding: 10px 0;
        }
        .slider {
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">JEF Analysis</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Parameters</h2>
                
                <!-- Age Range Slider -->
                <div class="mb-4">
                    <label>Age Range:</label>
                    <div class="slider-container">
                        <input type="range" id="age-min" min="18" max="87" value="30" class="slider">
                        <input type="range" id="age-max" min="18" max="87" value="45" class="slider">
                        <span id="age-range-display"></span>
                    </div>
                </div>

                <!-- IQ Range Slider -->
                <div class="mb-4">
                    <label>IQ Range:</label>
                    <div class="slider-container">
                        <input type="range" id="iq-min" min="73" max="126" value="85" class="slider">
                        <input type="range" id="iq-max" min="73" max="126" value="115" class="slider">
                        <span id="iq-range-display"></span>
                    </div>
                </div>

                <!-- Score Inputs -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label>PL</label>
                        <input type="number" id="PL" value="50" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>PR</label>
                        <input type="number" id="PR" value="100" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>ST</label>
                        <input type="number" id="ST" value="50" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>CT</label>
                        <input type="number" id="CT" value="25" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>AT</label>
                        <input type="number" id="AT" value="0" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>EBPM</label>
                        <input type="number" id="EBPM" value="25" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>ABPM</label>
                        <input type="number" id="ABPM" value="75" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>TBPM</label>
                        <input type="number" id="TBPM" value="50" class="w-full border rounded p-2">
                    </div>
                    <div>
                        <label>AVG</label>
                        <input type="number" id="AVG" value="46.9" class="w-full border rounded p-2">
                    </div>
                </div>

                <button id="calculate" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">
                    Calculate
                </button>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <div id="plotDiv"></div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript code for handling user interactions and API calls
        document.getElementById('calculate').addEventListener('click', async () => {
            const ageMin = parseInt(document.getElementById('age-min').value);
            const ageMax = parseInt(document.getElementById('age-max').value);
            const iqMin = parseInt(document.getElementById('iq-min').value);
            const iqMax = parseInt(document.getElementById('iq-max').value);

            const scores = {};
            ['PL', 'PR', 'ST', 'CT', 'AT', 'EBPM', 'ABPM', 'TBPM', 'AVG'].forEach(id => {
                scores[id] = parseFloat(document.getElementById(id).value);
            });

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        age_range: [ageMin, ageMax],
                        iq_range: [iqMin, iqMax],
                        scores: scores
                    }),
                });

                const data = await response.json();
                
                // Create z-score plot
                const plotData = [{
                    x: Object.keys(data.z_scores),
                    y: Object.values(data.z_scores),
                    type: 'bar',
                    marker: {
                        color: Object.values(data.z_scores).map(value => 
                            value >= 0 ? 'rgb(255,0,0)' : 'rgb(0,0,255)')
                    }
                }];

                const layout = {
                    title: 'Z-Scores',
                    yaxis: {
                        title: 'Z-score',
                        range: [-5, 5]
                    },
                    shapes: [{
                        type: 'line',
                        x0: -0.5,
                        x1: 8.5,
                        y0: -2,
                        y1: -2,
                        line: {
                            color: 'rgb(0, 0, 255)',
                            width: 2,
                            dash: 'dash'
                        }
                    }]
                };

                Plotly.newPlot('plotDiv', plotData, layout);
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
